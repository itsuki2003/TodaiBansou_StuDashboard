# 1. 認証機能

## 1-1. ログイン画面

### 1. UI/UX 設計（ワイヤーフレーム）

- **画面タイトル:** ログイン
- **入力フォーム:**
  - **メールアドレス:** テキスト入力欄
  - **パスワード:** パスワード入力欄（入力中は文字が隠れる）
- **操作ボタン:**
  - **ログインボタン:** 「ログイン」
- **エラーメッセージ表示エリア:**
  - ログイン失敗時に「メールアドレスまたはパスワードが正しくありません」といったメッセージを表示する。

### 2. DB 設計

- **関連テーブル:** `instructors`
- **利用カラム:**
  - `email`: ログイン ID として利用。一意（ユニーク）である必要がある。
  - `password_digest`: ハッシュ化されたパスワードを保存。
  - `supabase_uid`: Supabase Auth の UID を保存。`instructors.id` は内部で配布される ID であり、RLS ポリシーはこの `supabase_uid` を参照する。

### 3. 詳細機能仕様

- **認証方式:**
  - **JWT (JSON Web Token) + Refresh Token** パターンを採用する。
  - Access Token は有効期間を短く（例: 15 分）設定し、Refresh Token はより長く（例: 7 日間）設定する。
- **トークン保存方法:**
  - Access Token はメモリ上で管理し、Refresh Token は**HTTPOnly, Secure 属性を付与した Cookie**に保存する。これにより、XSS（クロスサイトスクリプティング）によるトークン窃取リスクを低減する。
- **CSRF (クロスサイトリクエストフォージェリ) 対策:**
  - サーバーは CSRF トークンを生成し、フロントエンドは API リクエスト時にこのトークンをカスタムヘッダーに含めて送信する（Double Submit Cookie 方式）。
- **基本フロー:**
  1. 認証成功時、サーバーは Access Token と Refresh Token を発行する。
  2. フロントエンドは以降の API リクエスト時に Access Token を Authorization ヘッダーに付与する。
  3. Access Token の有効期限が切れた場合、フロントエンドは Refresh Token を使って新しい Access Token の再発行を要求する。

## 1-2. パスワードリセット機能

### UI/UX 設計

1. **申請画面:**
   - ログイン画面の「パスワードを忘れた場合はこちら」リンクから遷移する。
   - メールアドレスを入力するフォームと「送信」ボタンを設置。
2. **申請完了画面:**
   - 「パスワード再設定用の URL を記載したメールを送信しました」と表示。
3. **パスワード再設定画面:**
   - メール内の URL から遷移する。
   - 新しいパスワードを 2 回入力するフォームと「更新」ボタンを設置。

### 機能仕様

- ユーザーがメールアドレスを入力して送信すると、システムは一意で有効期限付きのトークンを生成し、再設定用 URL に含めてメールで送信する。
- ユーザーが新しいパスワードを入力して更新すると、DB の`password_digest`を更新する。
- トークンは一度使用されるか、有効期限（例: 1 時間）が切れると無効になる。

## 1-3. ログアウト機能

### UI/UX 設計

- 全ての画面のヘッダーなど、常に表示される場所に「ログアウト」ボタンまたはリンクを配置する。

### 機能仕様

- 「ログアウト」ボタンをクリックすると、サーバー上のセッション情報を破棄する。
- 処理完了後、ユーザーをログイン画面にリダイレクトする。
