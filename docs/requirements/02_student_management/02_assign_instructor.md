# 2-2. 担当講師の割り当て画面

## 1. UI/UX 設計（ワイヤーフレーム）

- **画面タイトル:** 担当講師の割り当て
- **生徒選択エリア:**
  - **生徒:** 検索可能なドロップダウン
- **担当講師スロットエリア:**
  - 初期表示ではスロットを非表示とする。
  - 生徒を選択すると、以下の 3 つのスロットが表示される。
  - **スロット 1:** 講師を選択するドロップダウンリスト
  - **スロット 2:** 講師を選択するドロップダウンリスト
  - **スロット 3:** 講師を選択するドロップダウンリスト
  - 各ドロップダウンの選択肢には、「担当なし」と全講師名の一覧が表示される。
- **操作ボタン:**
  - **保存ボタン:** 「割り当てを保存する」

## 2. DB 設計

- **関連テーブル:** `students`, `instructors`, `student_instructors` (中間テーブル)
- **リレーションシップ:**
  - 生徒と講師は「多対多」の関係。
  - `student_instructors`テーブルが両者の関連を管理する (`student_id`, `instructor_id`)。

## 3. 詳細機能仕様

- **アクセス権限:**
  - **管理者**のみがこの画面を利用できる。
- **画面初期表示:**
  - 担当講師スロットエリアは非表示。
- **生徒を選択した時の動作:**
  - 選択した生徒の担当講師を`student_instructors`テーブルから検索する。
  - 見つかった講師を、スロット 1 から順番にドロップダウンの選択値として設定する。
  - 担当講師が 3 名に満たない場合、残りのスロットは「担当なし」を初期値とする。
- **保存処理:**
  - 「保存ボタン」が押された際、まず対象生徒の割り当てを`student_instructors`テーブルから**全て削除**する。
  - 次に、各スロットで「担当なし」以外が選択されている講師の組み合わせで、`student_instructors`テーブルに新しいレコードを**挿入**する (0〜3 件)。
  - リクエストには現在の割り当ての`updated_at`を含め、保存時に一致しなければ HTTP 409 (Conflict) を返却し処理を中断する。
  - 保存成功時は「割り当てを保存しました」のフィードバックを表示し、生徒選択をクリアしてスロットエリアを再び非表示に戻す。
- **バリデーション（入力チェック）:**
  - 保存時に、複数のスロットで同じ講師が選択されていないかチェックする。
  - 重複していた場合はエラーメッセージを表示し、処理を中断する。
